{"ast":null,"code":"import jwt from 'jsonwebtoken';\nimport bcrypt from 'bcrypt';\nimport UserModel from \"./user.js\";\nimport { registerValidation } from './auth.js';\nexport const register = async (req, res) => {};\nexport const login = async (req, res) => {\n  try {\n    const user = await UserModel.findOne({\n      email: req.body.email\n    });\n    //console.log(UserModel.findOne({ email: req.body.email }));\n    if (!user) {\n      return res.status(400).json({\n        Message: 'nema takoho user`a'\n      });\n    }\n    const isValidPass = await bcrypt.compare(req.body.password, user._doc.passwordHash);\n    if (!isValidPass) {\n      return res.status(400).json({\n        message: 'wrong log or pass'\n      });\n    }\n    const token = jwt.sign({\n      _Id: user.id\n    }, 'kluch', {\n      expiresIn: '30d'\n    });\n    res.json({\n      user,\n      token\n    });\n  } catch (err) {\n    console.log(err);\n    res.status(500).json({\n      message: 'shos pishlo ne tak'\n    });\n  }\n};\nexport const getMe = async (req, res) => {\n  try {\n    const user = await UserModel.findById(req.userId);\n    //console.log(UserModel.findOne(req.ObjectId));\n\n    if (!user) {\n      //console.log(user);\n      return res.status(404).json({\n        message: 'no such user'\n      });\n    }\n    res.json({\n      user\n    });\n  } catch (err) {\n    console.log(err);\n    res.status(500).json({\n      message: 'shos pishlo ne tak'\n    });\n  }\n};\n\n/*function slowScroll(id) {\r\n    $('html, body').animate({\r\n        scrollTop: $(id).offset().top\r\n    }, 550);\r\n}\r\n\r\n$(document).on(\"scroll\", function () {\r\n    if ($(window).scrollTop() === 0)\r\n        $(\"header\").removeClass(\"fixed\");\r\n    else\r\n        $(\"header\").attr(\"class\", \"fixed\");\r\n});*/","map":{"version":3,"names":["jwt","bcrypt","UserModel","registerValidation","register","req","res","login","user","findOne","email","body","status","json","Message","isValidPass","compare","password","_doc","passwordHash","message","token","sign","_Id","id","expiresIn","err","console","log","getMe","findById","userId"],"sources":["C:/xz/delivery/src/my-app/functions.js"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\nimport bcrypt from 'bcrypt';\r\n\r\nimport UserModel from \"./user.js\";\r\nimport { registerValidation } from './auth.js';\r\n\r\nexport const register = async (req, res) => {\r\n    \r\n}\r\nexport const login = async (req, res) => {\r\n    try {\r\n        const user = await UserModel.findOne({ email: req.body.email });\r\n        //console.log(UserModel.findOne({ email: req.body.email }));\r\n        if (!user) {\r\n            return res.status(400).json({\r\n                Message: 'nema takoho user`a',\r\n            });\r\n        }\r\n\r\n        const isValidPass = await bcrypt.compare(req.body.password, user._doc.passwordHash);\r\n        if (!isValidPass) {\r\n            return res.status(400).json({\r\n                message: 'wrong log or pass'\r\n            });\r\n        }\r\n\r\n        const token = jwt.sign({\r\n            _Id: user.id,\r\n        },\r\n            'kluch',\r\n            {\r\n                expiresIn: '30d',\r\n            }\r\n        )\r\n\r\n        res.json({ user, token, });\r\n\r\n\r\n\r\n    } catch (err) {\r\n        console.log(err);\r\n        res.status(500).json({\r\n            message: 'shos pishlo ne tak',\r\n        });\r\n    }\r\n};\r\n\r\nexport const getMe = async (req, res) => {\r\n    try {\r\n        const user = await UserModel.findById(req.userId);\r\n        //console.log(UserModel.findOne(req.ObjectId));\r\n\r\n        if (!user) {\r\n            //console.log(user);\r\n            return res.status(404).json({\r\n                message: 'no such user',\r\n\r\n            });\r\n        }\r\n\r\n        res.json({ user, });\r\n    }\r\n    catch (err) {\r\n        console.log(err);\r\n        res.status(500).json({\r\n            message: 'shos pishlo ne tak',\r\n        });\r\n    }\r\n};\r\n\r\n/*function slowScroll(id) {\r\n    $('html, body').animate({\r\n        scrollTop: $(id).offset().top\r\n    }, 550);\r\n}\r\n\r\n$(document).on(\"scroll\", function () {\r\n    if ($(window).scrollTop() === 0)\r\n        $(\"header\").removeClass(\"fixed\");\r\n    else\r\n        $(\"header\").attr(\"class\", \"fixed\");\r\n});*/"],"mappings":"AAAA,OAAOA,GAAG,MAAM,cAAc;AAC9B,OAAOC,MAAM,MAAM,QAAQ;AAE3B,OAAOC,SAAS,MAAM,WAAW;AACjC,SAASC,kBAAkB,QAAQ,WAAW;AAE9C,OAAO,MAAMC,QAAQ,GAAG,MAAAA,CAAOC,GAAG,EAAEC,GAAG,KAAK,CAE5C,CAAC;AACD,OAAO,MAAMC,KAAK,GAAG,MAAAA,CAAOF,GAAG,EAAEC,GAAG,KAAK;EACrC,IAAI;IACA,MAAME,IAAI,GAAG,MAAMN,SAAS,CAACO,OAAO,CAAC;MAAEC,KAAK,EAAEL,GAAG,CAACM,IAAI,CAACD;IAAM,CAAC,CAAC;IAC/D;IACA,IAAI,CAACF,IAAI,EAAE;MACP,OAAOF,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBC,OAAO,EAAE;MACb,CAAC,CAAC;IACN;IAEA,MAAMC,WAAW,GAAG,MAAMd,MAAM,CAACe,OAAO,CAACX,GAAG,CAACM,IAAI,CAACM,QAAQ,EAAET,IAAI,CAACU,IAAI,CAACC,YAAY,CAAC;IACnF,IAAI,CAACJ,WAAW,EAAE;MACd,OAAOT,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBO,OAAO,EAAE;MACb,CAAC,CAAC;IACN;IAEA,MAAMC,KAAK,GAAGrB,GAAG,CAACsB,IAAI,CAAC;MACnBC,GAAG,EAAEf,IAAI,CAACgB;IACd,CAAC,EACG,OAAO,EACP;MACIC,SAAS,EAAE;IACf,CAAC,CACJ;IAEDnB,GAAG,CAACO,IAAI,CAAC;MAAEL,IAAI;MAAEa;IAAO,CAAC,CAAC;EAI9B,CAAC,CAAC,OAAOK,GAAG,EAAE;IACVC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;IAChBpB,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACjBO,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;AAED,OAAO,MAAMS,KAAK,GAAG,MAAAA,CAAOxB,GAAG,EAAEC,GAAG,KAAK;EACrC,IAAI;IACA,MAAME,IAAI,GAAG,MAAMN,SAAS,CAAC4B,QAAQ,CAACzB,GAAG,CAAC0B,MAAM,CAAC;IACjD;;IAEA,IAAI,CAACvB,IAAI,EAAE;MACP;MACA,OAAOF,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBO,OAAO,EAAE;MAEb,CAAC,CAAC;IACN;IAEAd,GAAG,CAACO,IAAI,CAAC;MAAEL;IAAM,CAAC,CAAC;EACvB,CAAC,CACD,OAAOkB,GAAG,EAAE;IACRC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;IAChBpB,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACjBO,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}