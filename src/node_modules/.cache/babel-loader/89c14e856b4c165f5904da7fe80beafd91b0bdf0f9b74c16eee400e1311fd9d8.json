{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.matchedData = void 0;\nconst _ = require(\"lodash\");\nconst base_1 = require(\"./base\");\n/**\n * Extracts data validated or sanitized from the request, and builds an object with them.\n *\n * @param req the express request object\n * @param options\n * @returns an object of data that's been validated or sanitized in the passed request\n */\nfunction matchedData(req) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const internalReq = req;\n  const fieldExtractor = createFieldExtractor(options.includeOptionals !== true);\n  const validityFilter = createValidityFilter(options.onlyValidData);\n  const locationFilter = createLocationFilter(options.locations);\n  return _(internalReq[base_1.contextsKey]).flatMap(fieldExtractor).filter(validityFilter).map(field => field.instance).filter(locationFilter).reduce((state, instance) => _.set(state, instance.path, instance.value), {}).valueOf();\n}\nexports.matchedData = matchedData;\nfunction createFieldExtractor(removeOptionals) {\n  return context => {\n    const instances = context.getData({\n      requiredOnly: removeOptionals\n    });\n    return instances.map(instance => ({\n      instance,\n      context\n    }));\n  };\n}\nfunction createValidityFilter() {\n  let onlyValidData = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n  return !onlyValidData ? () => true : field => {\n    const hasError = field.context.errors.some(error => error.location === field.instance.location && error.param === field.instance.path);\n    return !hasError;\n  };\n}\nfunction createLocationFilter() {\n  let locations = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  // No locations mean all locations\n  const allLocations = locations.length === 0;\n  return allLocations ? () => true : field => locations.includes(field.location);\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","matchedData","_","require","base_1","req","options","arguments","length","undefined","internalReq","fieldExtractor","createFieldExtractor","includeOptionals","validityFilter","createValidityFilter","onlyValidData","locationFilter","createLocationFilter","locations","contextsKey","flatMap","filter","map","field","instance","reduce","state","set","path","valueOf","removeOptionals","context","instances","getData","requiredOnly","hasError","errors","some","error","location","param","allLocations","includes"],"sources":["C:/xz/delivery/src/node_modules/express-validator/src/matched-data.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.matchedData = void 0;\nconst _ = require(\"lodash\");\nconst base_1 = require(\"./base\");\n/**\n * Extracts data validated or sanitized from the request, and builds an object with them.\n *\n * @param req the express request object\n * @param options\n * @returns an object of data that's been validated or sanitized in the passed request\n */\nfunction matchedData(req, options = {}) {\n    const internalReq = req;\n    const fieldExtractor = createFieldExtractor(options.includeOptionals !== true);\n    const validityFilter = createValidityFilter(options.onlyValidData);\n    const locationFilter = createLocationFilter(options.locations);\n    return _(internalReq[base_1.contextsKey])\n        .flatMap(fieldExtractor)\n        .filter(validityFilter)\n        .map(field => field.instance)\n        .filter(locationFilter)\n        .reduce((state, instance) => _.set(state, instance.path, instance.value), {})\n        .valueOf();\n}\nexports.matchedData = matchedData;\nfunction createFieldExtractor(removeOptionals) {\n    return (context) => {\n        const instances = context.getData({ requiredOnly: removeOptionals });\n        return instances.map((instance) => ({ instance, context }));\n    };\n}\nfunction createValidityFilter(onlyValidData = true) {\n    return !onlyValidData\n        ? () => true\n        : (field) => {\n            const hasError = field.context.errors.some(error => error.location === field.instance.location && error.param === field.instance.path);\n            return !hasError;\n        };\n}\nfunction createLocationFilter(locations = []) {\n    // No locations mean all locations\n    const allLocations = locations.length === 0;\n    return allLocations ? () => true : (field) => locations.includes(field.location);\n}\n"],"mappings":"AAAA,YAAY;;AACZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,WAAW,GAAG,KAAK,CAAC;AAC5B,MAAMC,CAAC,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAC3B,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAQ,CAAC;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASF,WAAWA,CAACI,GAAG,EAAgB;EAAA,IAAdC,OAAO,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;EAClC,MAAMG,WAAW,GAAGL,GAAG;EACvB,MAAMM,cAAc,GAAGC,oBAAoB,CAACN,OAAO,CAACO,gBAAgB,KAAK,IAAI,CAAC;EAC9E,MAAMC,cAAc,GAAGC,oBAAoB,CAACT,OAAO,CAACU,aAAa,CAAC;EAClE,MAAMC,cAAc,GAAGC,oBAAoB,CAACZ,OAAO,CAACa,SAAS,CAAC;EAC9D,OAAOjB,CAAC,CAACQ,WAAW,CAACN,MAAM,CAACgB,WAAW,CAAC,CAAC,CACpCC,OAAO,CAACV,cAAc,CAAC,CACvBW,MAAM,CAACR,cAAc,CAAC,CACtBS,GAAG,CAACC,KAAK,IAAIA,KAAK,CAACC,QAAQ,CAAC,CAC5BH,MAAM,CAACL,cAAc,CAAC,CACtBS,MAAM,CAAC,CAACC,KAAK,EAAEF,QAAQ,KAAKvB,CAAC,CAAC0B,GAAG,CAACD,KAAK,EAAEF,QAAQ,CAACI,IAAI,EAAEJ,QAAQ,CAACzB,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAC5E8B,OAAO,EAAE;AAClB;AACA/B,OAAO,CAACE,WAAW,GAAGA,WAAW;AACjC,SAASW,oBAAoBA,CAACmB,eAAe,EAAE;EAC3C,OAAQC,OAAO,IAAK;IAChB,MAAMC,SAAS,GAAGD,OAAO,CAACE,OAAO,CAAC;MAAEC,YAAY,EAAEJ;IAAgB,CAAC,CAAC;IACpE,OAAOE,SAAS,CAACV,GAAG,CAAEE,QAAQ,KAAM;MAAEA,QAAQ;MAAEO;IAAQ,CAAC,CAAC,CAAC;EAC/D,CAAC;AACL;AACA,SAASjB,oBAAoBA,CAAA,EAAuB;EAAA,IAAtBC,aAAa,GAAAT,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;EAC9C,OAAO,CAACS,aAAa,GACf,MAAM,IAAI,GACTQ,KAAK,IAAK;IACT,MAAMY,QAAQ,GAAGZ,KAAK,CAACQ,OAAO,CAACK,MAAM,CAACC,IAAI,CAACC,KAAK,IAAIA,KAAK,CAACC,QAAQ,KAAKhB,KAAK,CAACC,QAAQ,CAACe,QAAQ,IAAID,KAAK,CAACE,KAAK,KAAKjB,KAAK,CAACC,QAAQ,CAACI,IAAI,CAAC;IACtI,OAAO,CAACO,QAAQ;EACpB,CAAC;AACT;AACA,SAASlB,oBAAoBA,CAAA,EAAiB;EAAA,IAAhBC,SAAS,GAAAZ,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;EACxC;EACA,MAAMmC,YAAY,GAAGvB,SAAS,CAACX,MAAM,KAAK,CAAC;EAC3C,OAAOkC,YAAY,GAAG,MAAM,IAAI,GAAIlB,KAAK,IAAKL,SAAS,CAACwB,QAAQ,CAACnB,KAAK,CAACgB,QAAQ,CAAC;AACpF"},"metadata":{},"sourceType":"module","externalDependencies":[]}